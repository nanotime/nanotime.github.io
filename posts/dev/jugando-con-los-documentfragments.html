<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="description" content="Aprendiendo como utilizar los documentFragments para mejorar el performance en el manejo en el DOM">
    <meta name="keywords" content="javascript,DOM,jQuery,DocumentFragments">
    <meta name="author" content="Nano">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Jugando con los DocumentFragments</title><link rel='stylesheet' href='/css/master.css' />
<link rel='stylesheet' href='/css/icons.css' />
<link rel='stylesheet' href='/css/prism.css' />
  </head>
  <body>
    <header id="site-head">
      <div class="title-container">
        <h1 class="site-title">Un bit a la vez</h1>
        <h3 class="site-description">La vida de un programador aburrido</h3>
      </div>
    </header>
    <nav id="site-nav">
      <ul>
        <li class="nav-item"><a href="/"><i class="icon-home2"></i></a></li>
        <li class="nav-item"><a href="http://www.github.com/nanotime" target="_blank"><i class="icon-github"></i></a></li>
        <li class="nav-item"><a href="http://www.twitter.com/_nanodice_" target="_blank"><i class="icon-twitter3"></i></a></li>
        <li class="nav-item"><a href="#"><i class="icon-briefcase"></i></a></li>
      </ul>
    </nav>
    <article class="post">
      <h2>Jugando con los DocumentFragments</h2>
          <div class="postbox">
            <div>
              <p class="postbox-item"><i class="icon-pacman"> </i>Nano
              </p>
              <p class="postbox-item"><i class="icon-clock"></i>5/06/2015
              </p>
              <p class="postbox-item"><i class="icon-price-tags"></i>posts
              </p>
            </div>
          </div>
          <div class="heading-img"><img src="../../img/js.png" alt="no definido" class="hero-img"></div><h4 id="introducci-n">Introducción</h4>
<p>Algo a lo que me he dedicado casi todo mi tiempo como programador es a aprender sobre <strong>Javascript</strong> (JS de ahora en mas), sinceramente es el único lenguaje al que le he dedicado un esfuerzo real de aprendizaje, y tomando en cuenta que soy autodidacta en, literalmente, todo lo referente a la programación, pues es mucho decir.</p>
<p>Muchas de las cosas que la gente suele decir de JS es que no está hecho para grandes cargas, que si es un lenguaje interpretado, que si esto o aquello... sobre todo cuando se habla de performance, JS es el eterno estigmatizado.</p>
<p>En fin, una de las tantísimas cosas que este lenguaje te permite (junto con, claro, los motores de renderizado y el <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model">DOM</a>) es crear elementos dinámicamente.</p>
<p>Hagamos un ejercicio rápido usando JS vainilla, para crear elementos, supongamos que tenemos una super-mega-app, que crea un elemento <code>p</code> y luego le inserta una cadena de texto.</p>

      <pre><code class="language-javascript">// Nos olvidamos de todo lo demas y suponemos que ya estamos en modulo.

textear(document.createElement('p'), 'olakease');

// Somos geniales y hacemos uso de funciones utilitarias para no ofuscar código
function textear (nodo, texto) {
  var txt = document.createTextNode(text);
  nodo.appendChild(txt);
  return nodo;
}
</code></pre><p>Y basicamente, por encimita, tenemos un snippet que crea un nodo y a este le interta otro nodo de texto. Easy. ¿Pero que pasa si tenemos que hacer esto recurrentemente? Estar creando un elemento a cada rato y dentro de este meter otro elemento irá consumiendo cada vez mas, porque en cada vuelta del bucle que uses, estás haciendo el proceso desde cero... <em>mala, muy mala idea</em></p>
<p>Hay que ser un tipo rudo cuando se programa, hay que tenerlas bien puestas cuando se trata de resolver problemas y hacer que tu código sea eficiente, programes en el lenguaje que programes, <strong>preocúpate por el performance, siempre. No te pases de verga</strong>.</p>
<p>La aproximación anterior no es incorrecta, es perfectamente aceptable y da resultados en el sentido mas pragmático de la palabra... pero no es la mejor manera de hacerlo.</p>
<h4 id="documentfragments-los-bad-ass-de-su-reino">DocumentFragments... los bad-ass de su reino</h4>
<p>La manera de describirlos, de forma escueta pero directa vendría siendo algo como un contenedor de elementos muy ligero que se carga en memoria y permite rellenarse con nodos DOM. Además, estos pertenecen a la revisión DOM 1, ingresada en (<em>que no cunda en pánico</em>) Internet explorer... <strong>6</strong>, o sea que no hay razón alguna para no usarlos, hoy día no existe ni un solo navegador que no los soporte 100%.</p>
<p>Yendo mas adentro y parafraseando una de mis fuentes:</p>
<blockquote>
<p>Además, varias operaciones (como insertar nodos hijo de otro nodo, o en otro nodo) pueden tomar como argumento un objeto DocumentFragment. Esto resulta en que todos los nodos dentro del DocumentFragment son movidos a la lista de nodos hijo donde se inserta el objeto.</p>
</blockquote>
<p>Dicho en cristiano: <em>puedes rellenar un document Fragment como quieras, y luego, en una sola operación, descargar todo su contenido en un nodo permanente</em>. Hagamos un ejercicio rapidito:</p>

      <pre><code class="language-javascript">// Tendremos un nodo ul al que le insertaremos 100 nodos li.

var nodeUl = document.querySelector('ul'); // suponiendo que solo hay uno.
var docFrag = document.createDocumentFragment();

docFrag.appendChild( textear(document.createElement('li'), 'olakease') );

for (var i = 0; i < 100; i++) {
  nodeUl.appendChild(docFrag.cloneNode(true));
}

function textear (nodo, texto) {
  nodo.appendChild(document.createTextNode(texto));
  return nodo;
}
</code></pre><p>Lo interesante aca es que, en vez de crear un nodo nuevo con cada vuelta del bucle, que es lo que uno pensaría hacer de plano, estamos <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode"><em>clonando con cloneNode(true)</em></a> el nodo, cuestión bastante mas ligera.</p>
<p>Hay que tomar en cuenta que los docFrags son bastante mas rápidos, pero un tanto mas complejos de usar porque no puedes iterar a traves de ellos (son nodos virtuales, recuerda), de hecho si tratases de hacerlo, te saltaria algo como esto:</p>

      <pre><code class="language-javascript">TypeError: Argument 1 of Node.appendChild is not an object.
</code></pre><p>Otra cosa que se necesita saber es que no vas a usar un docFrag para todo, tienes que construir distintos documentFragments para distintas estructuras, y claro que abusar de ellos no es la idea.</p>

          <p class="notice">Mi idea hasta acá era mostrar un benchmark, pero la manera fácil de hacerlo no es viable, así que tendrá que esperar un poco hasta que monte una suite de benchmarks con benchmark.js y haga las pruebas.</p><h4 id="y-si-queremos-usar-jquery-">Y si queremos usar jQuery?</h4>
<p>Resulta que <strong>jQuery</strong> nos hace la vida más fácil en muchisimos casos, aunque eso si, admito que también es una librería bastante grande y a veces poco amigable con los entornos móviles... no es el punto aca.</p>
<p>Hay una sintaxis para trabajar con los docFrags en jQuery, simple por demás, basta con declarar:</p>

      <pre><code class="language-javascript">$("&ltnode&gt")
</code></pre><p>Y estás creando un documentFragment.</p>
<p>De hecho, puedes ir mucho mas allá y darle formato (clases, atributos extra) con la API propia de la librería, algo vagamente así:</p>

      <pre><code class="language-javascript">$("&ltnode&gt")
  .attr('class', 'dummie')
  .text('dummieText')
  .click(//agrega tu funcion aqui)
</code></pre><p>Es de hecho algo mucho muy interesante, de hecho ahora mismo estoy usando esta aproximación en un pequeño proyecto personal, que está a la vista y seguro no notas, y que pronto revelaré.</p>
<h4 id="fuentes-y-sitios-de-inter-s">Fuentes y sitios de interés</h4>
<ul>
<li><a href="http://ejohn.org/blog/dom-documentfragments/">John Resig, Document Fragmets</a></li>
<li><a href="http://ejohn.org/apps/workshop/adv-talk/">Things You Might Not Know About jQuery (habla sobre los docFrags en jQuery)</a></li>
<li><a href="http://mrforbes.com/blog/2013/01/web-performance-optimization-tip-jquery-document-fragments/">Web Performance Optimization Tip – jQuery + Document Fragments</a></li>
<li><a href="http://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-B63ED1A3">Extracto de la especificación de la W3C</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment">Definición en MDN (Mozilla Developer Network)</a></li>
</ul>

          <div class="social-wrapper"><a href="/" class="goback social-item"><i class="icon-home2"></i></a><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fnanotime.github.io%2F" target="_blank" class="social-item facebook"><i class="icon-facebook3"></i></a><a href="https://twitter.com/intent/tweet?url=http://nanotime.github.io&amp;text=Jugando con los DocumentFragments&amp;via=_nanodice_" target="_blank" class="social-item twitter"><i class="icon-twitter3"></i></a><a href="https://plus.google.com/share?url=http://nanotime.github.io" target="_blank" class="social-item google-plus"><i class="icon-google-plus3"></i></a></div>
          <p class="warning">Por motivos que no puedo resolver, los comentarios estan deshabilitados</p>
    </article><script src='/js/vendor/jquery-2.1.4.min.js'></script>
<script src='/js/vendor/jquery-nanopaginator.js'></script>
<script src='/js/prism.js'></script>
<script src='/js/main.js'></script>
  </body>
</html>